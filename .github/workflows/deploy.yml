name: Deploiement Automatique

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    runs-on: self-hosted

    steps:
    # 1. On r√©cup√®re le code
    - uses: actions/checkout@v3

    # 2. PARTIE CI : Le Test de Qualit√©
    # On cherche le mot "INTERDIT" dans index.html
    # Si on le trouve, grep renvoie 0 (succ√®s), donc on force une erreur (exit 1)
    - name: Test de S√©curit√© (CI)
      run: |
        if grep -q "INTERDIT" index.html; then
          echo "‚õî ERREUR : Contenu interdit d√©tect√© !"
          exit 1
        else
          echo "‚úÖ Test valid√© : Code propre."
        fi

    # 3. PARTIE CD : Le D√©ploiement
    # Cette √©tape ne se lance QUE si l'√©tape pr√©c√©dente a r√©ussi
    - name: Mise √† jour du site web
      run: |
        cp index.html /var/www/html/index.html
        echo "üöÄ Site mis √† jour avec succ√®s !"